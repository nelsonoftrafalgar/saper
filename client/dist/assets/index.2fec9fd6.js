import{C as e}from"./vendor.0b0a61ba.js";const t=e=>{const[s,i]=e.id.split(",");var o,n;(o=+s,n=+i,[[o-1,n],[o-1,n+1],[o,n+1],[o+1,n+1],[o+1,n],[o+1,n-1],[o,n-1],[o-1,n-1]]).map((e=>e.join(","))).forEach((e=>{const s=document.querySelector(`td[id='${e}']`);if(s){const{textContent:e,dataset:i}=s;e&&(i.checked="true"),e||i.checked||(i.checked="true",t(s));const o=s.firstElementChild;o&&s.removeChild(o)}}))};const s=new class{constructor(e,t,s,i){this.handleSetRows=e=>{const{value:t}=e.target;this.rows=+t},this.handleSetCols=e=>{const{value:t}=e.target;this.cols=+t},this.handleSetLevel=e=>{const{value:t}=e.target;this.level=+t},this.incrementBombs=()=>this.bombs++,this.resetBombs=()=>this.bombs=0,this.getBombCount=()=>this.bombs,this.rows=e,this.cols=t,this.bombs=s,this.level=i}}(10,10,0,.9),i=e=>{const t=[];for(let s=e.length-1;s>=0;s--)t.unshift(["&#",e[s].charCodeAt(0),";"].join(""));return t.join("")};const o=new class{constructor(e,t){this.isInitialClick=!0,this.setStatus=e=>{clearInterval(this.interval),this.status.innerHTML=e},this.hasBomb=e=>i(e).includes("&#9881;"),this.disableCellEvents=()=>{document.querySelectorAll(".cell").forEach((e=>{var t;const s=e.cloneNode(!0);null==(t=e.parentNode)||t.replaceChild(s,e)}))},this.checkIsWin=()=>{s.rows*s.cols-document.querySelectorAll("td[data-checked=true]").length===s.bombs&&(this.setStatus("&#9786;"),this.disableCellEvents())},this.startGame=()=>{this.handleTimer(),this.checkIsWin()},this.handleTimer=()=>{if(this.isInitialClick){const e=document.querySelector(".time-counter");let t=0;this.interval=window.setInterval((()=>{t++,e.innerHTML=String(t)}),1e3)}this.isInitialClick=!1},this.blowUpAllBombs=()=>{document.querySelectorAll(".table-data").forEach((e=>{this.hasBomb(e.innerHTML)&&e.firstElementChild&&e.removeChild(e.firstElementChild)}))},this.handleGameOver=()=>{this.disableCellEvents(),this.setStatus("&#9760;"),this.blowUpAllBombs()},this.interval=e,this.status=t}}(0,document.querySelector(".game-result"));class n{constructor(e){this.clickCache=0,this.handleLeftClick=()=>{const e=this.cell.parentElement,{startGame:s,hasBomb:i,handleGameOver:n}=o;e.removeChild(this.cell),i(e.innerHTML)?(e.style.background="red",n()):e.dataset.checked="true",e.innerHTML||t(e),s()},this.handleRightClick=e=>{switch(e.preventDefault(),this.clickCache+=1,3===this.clickCache&&(this.clickCache=0),this.clickCache){case 0:this.cell.innerHTML="";break;case 1:this.cell.innerHTML="&#9873;";break;case 2:this.cell.innerHTML="&#63;"}},e.addEventListener("click",this.handleLeftClick),e.addEventListener("contextmenu",this.handleRightClick),this.cell=e}}const r={1:"#00f",2:"#008200",3:"#f00",4:"#000084",5:"#840000",6:"#008284",7:"#840084",8:"#757575"},l=(e,t)=>{const s=document.createElement(e);return s.classList.add(t),s};class a{constructor(){this.setCell=e=>({value:t,id:i})=>{const o=l("td","table-data"),{cell:a}=new n(l("button","cell")),c=0===t;o.innerHTML=c?"&#9881;":t<9?String(t):"",c&&s.incrementBombs(),o.setAttribute("id",String(i)),o.appendChild(a),String(t)&&(o.style.color=r[String(t)]),e.appendChild(o)},this.createGame=e=>t=>{const s=l("tr","table-row");t.forEach(this.setCell(s)),e.appendChild(s)}}}class c{constructor(e){this.bombsToGo=s.getBombCount(),this.mutationCallback=e=>{e.forEach((({type:e,target:t,addedNodes:s,removedNodes:i})=>{"childList"===e&&"BUTTON"===t.nodeName&&(this.handleBombsCount(s,(()=>this.bombsToGo-=1)),this.handleBombsCount(i,(()=>this.bombsToGo+=1)))}))},this.handleBombsCount=(e,t)=>{e.forEach((e=>{"&#9873;"===i(e.textContent)&&(t(),this.bombCounter.textContent=String(this.bombsToGo))}))},this.bombCounter=e,this.bombCounter.innerHTML=String(this.bombsToGo),this.gameObserver=new MutationObserver(this.mutationCallback)}}class h{constructor(t,i){this.game=new a,this.isGameLoaded=!1,this.setGame=async()=>{document.querySelector(".start").innerHTML="restart",this.isGameLoaded&&(e=>{const t=document.querySelector(".game-result"),s=document.querySelector(".time-counter");clearInterval(o.interval),o.isInitialClick=!0,t.textContent="",s.textContent="0",e.removeChild(e.lastElementChild)})(this.root),this.isGameLoaded=!0,this.displayLoader(!0);const e=await this.fetchBoard();this.displayLoader(!1),this.appendBoardToDOM(null==e?void 0:e.data.board),this.startObserver()},this.fetchBoard=async()=>{const{rows:t,cols:i,level:o}=s;return await e.get(this.apiUrl,{params:{rows:t,cols:i,level:o}}).catch(this.handleError)},this.appendBoardToDOM=e=>{s.resetBombs();const t=document.createElement("table");null==e||e.forEach(this.game.createGame(t)),this.root.appendChild(t)},this.startObserver=()=>{const{gameObserver:e}=new c(document.querySelector(".bomb-counter"));e.observe(this.root,{childList:!0,subtree:!0})},this.handleError=()=>{this.displayLoader(!1);let e=document.querySelector(".error");e&&this.root.removeChild(e),e=l("p","error"),e.innerHTML="API error. Please refresh and try again",this.root.appendChild(e)},this.displayLoader=e=>{if(e){const e=l("p","loader");e.innerHTML="Loading...",this.root.appendChild(e)}else{const e=document.querySelector(".loader");e&&this.root.removeChild(e)}},this.root=t,this.apiUrl=i}}const d=document.querySelector(".start"),m=document.querySelector(".rows"),u=document.querySelector(".cols"),b=document.querySelector(".level"),C=document.querySelector(".root");document.addEventListener("DOMContentLoaded",(()=>{const{setGame:e}=new h(C,"/api"),{handleSetCols:t,handleSetLevel:i,handleSetRows:o}=s;m.addEventListener("change",o),u.addEventListener("change",t),b.addEventListener("change",i),d.addEventListener("click",e)}));
